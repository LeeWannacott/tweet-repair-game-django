{% extends 'base.html' %} {% block content %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
            /* Make Horizontal. */
            li.list-group-item {
                margin-left: 0;
                margin-right: 0;
                padding-left: 0;
                padding-right: 0;
            }

            li.list-group-item {
                flex-grow: 1;
                list-style-type: none;
                text-align: center;
            }

            ul.list-group {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
            }
            /* styles draggable */
            .sortable-ghost {
             background: #cce5ff;   opacity: 0.6;
            }
            {% comment %}.sortable-chosen {{% endcomment %}
                {% comment %}opacity: 0.8;{% endcomment %}
                {% comment %}background-color:red;{% endcomment %}
            {% comment %}}{% endcomment %}
            .sortable-drag {
                {% comment %}background-color:lightcyan;{% endcomment %}
            }
            .highlighted {
             background: skyblue;   opacity: 0.8;
            }

        </style>
    </head>

    <body>
        <br />
        <h2 style="margin-left: 2rem">Repair broken tweet:</h2>
        <hr />

        {% if topic %} {{ topic }} {% endif %}
        <script>
            let originalTweetsInOrder = [];
            let countOfUserRearrangingTweet = 0;
            let tweetLength = 0;
            let score = 0;
        </script>

        {% for tweet in tweet_answers %} {% for word in tweet %}
        <script>
            tweetLength += 1;
            bestScore = tweetLength;
            originalTweetsInOrder.push("{{ word }}");
        </script>
        {% endfor %} {% endfor %}

        <!-- Latest Sortable -->
        <script src="https://raw.githack.com/SortableJS/Sortable/master/Sortable.js"></script>
        {% for tweet in muddled_tweets %}
        <div style="display: flex; justify-contents: space-between">
            <p style="margin-left: 2em; margin-right: 1em">
                Tweet Word Count: <span id="tweetLength"></span>
            </p>
            <p style="margin-right: 1em">Attempts: <span id="count"></span></p>
            <p style="margin-right: 1em">Score: <span id="score"></span></p>
        </div>

        <script>
            document.getElementById(
                "count"
            ).innerHTML = countOfUserRearrangingTweet;

            document.getElementById("tweetLength").innerHTML = tweetLength;
            score = tweetLength - countOfUserRearrangingTweet;
            document.getElementById("score").innerHTML = score;
        </script>

        <div class="alert alert-primary" role="alert">
            <ul class="list-group">
                {% for word in tweet %}
                <li class="list-group-item">{{word}}</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
        <br />
        <button
            type="button"
            class="btn btn-primary"
            onClick="window.location.reload()"
            style="margin-left: 2em"
        >
            New Tweet
        </button>
        <script>
            function compareOriginalTweetAndMuddledTweet() {
                countOfUserRearrangingTweet += 1;
                score = tweetLength - countOfUserRearrangingTweet;
                document.getElementById(
                    "count"
                ).innerHTML = countOfUserRearrangingTweet;
                document.getElementById("score").innerHTML = score;
                currentSlidableTweet = [];
                var listGroupItem = document.querySelectorAll(
                    "li.list-group-item"
                );

                // Makes list from the current li items position's.
                for (let slidable of listGroupItem) {
                    let listItem = slidable.innerHTML;
                    currentSlidableTweet.push(listItem);
                }
                // Compares current slidable position with original tweets.
                for (let [i, wordInTweet] of Object.entries(listGroupItem)) {
                    if (originalTweetsInOrder[i] == currentSlidableTweet[i]) {
                        wordInTweet = wordInTweet.style.backgroundColor =
                            "#90EE90"; //Green
                        countOfUserRearrangingTweet -= 1;
                    } else {
                        // console.log(wordInTweet.style.backgroundColor);
                        wordInTweet = wordInTweet.style.backgroundColor = "";
                        //white
                    }
                }
            }
            
            // Makes <li> items slidable.
            for (let tweetList of document.querySelectorAll("ul.list-group")) {
                 SortableTweetList = Sortable.create(tweetList, {
                    direction: "horizontal",
                    swap: "true",
                    ghostClass: "sortable-ghost",  // Class name for the drop placeholder
                    chosenClass: "sortable-chosen",  // Class name for the chosen item
                    dragClass: "sortable-drag",  // Class name for the dragging item
                    swapClass: "highlighted"
                });
            }

            console.log(SortableTweetList) 
            // Add event listener on dragend.
            for (let slidable of document.querySelectorAll(
                "li.list-group-item"
            )) {
                let defaultColorofSlidable = slidable.style.backgroundColor;
                // Evaluate tweet order if word correct colour green.
                slidable.addEventListener(
                    "dragend",
                    compareOriginalTweetAndMuddledTweet
                );
                // Support for touchscreens.
                {% comment %}slidable.addEventListener({% endcomment %}
                    {% comment %}"touchend",{% endcomment %}
                    {% comment %}compareOriginalTweetAndMuddledTweet{% endcomment %}
                {% comment %});{% endcomment %}

                // Shows visual indication of selected draggable on touchscreens.
                {% comment %}slidable.addEventListener("touchstart", function (event) {{% endcomment %}
                    {% comment %}// console.log(slidable.style.backgroundColor);{% endcomment %}

                    {% comment %}if ({% endcomment %}
                        {% comment %}slidable.style.backgroundColor !== "rgb(144, 238, 144)"{% endcomment %}
                    {% comment %}) {{% endcomment %}
                        {% comment %}slidable.style.backgroundColor = "#9AB6F1";{% endcomment %}
                    {% comment %}}{% endcomment %}
                {% comment %}});{% endcomment %}
                // Colours words back to white when leave each slideable on hover.
                {% comment %}slidable.addEventListener("dragleave", function (event) {{% endcomment %}
                    {% comment %}if ({% endcomment %}
                        {% comment %}slidable.style.backgroundColor !== "rgb(144, 238, 144)"{% endcomment %}
                    {% comment %}) {{% endcomment %}
                        {% comment %}slidable.style.backgroundColor = defaultColorofSlidable;{% endcomment %}
                    {% comment %}}{% endcomment %}
                {% comment %}});{% endcomment %}
            }
        </script>
    </body>
</html>
{% endblock %}
